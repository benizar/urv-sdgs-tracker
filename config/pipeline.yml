# File: config/pipeline.yml
# Global configuration for the URV SDGs tracker pipeline.
#
# This file is meant to centralise configuration for all pipeline phases:
#   - load (data access and loading)
#   - clean  (text cleaning and normalisation)
#   - translate (optional translation layer)
#   - sdg_detection (text2sdg parameters, model choices, etc.)
#   - export / analysis / dashboard (future work)
#
# Many sections and fields are commented out for now. They are placeholders
# for future extensions and documentation.

global:
  project_name: "URV SDGs tracker"

  parallel:
    enabled: true
    backend: "future"
    workers: 4

# -------------------------------------------------------------------
# load section
# -------------------------------------------------------------------
load:
  # Base directory to store all loaded datasets.
  root: "data"

  # Repository-level folder inside `root`. In practice this should
  # match the top-level folder inside the Zenodo zip.
  dir: "urv_teaching_guides"

  # Subdirectory inside `root/dir` for a specific scraping batch.
  subdir: "scraped-20251127"

  # URL of the Zenodo (or other) archive to download when the load
  # directory does not exist yet.
  url: ""

  # Local path to store the downloaded archive, relative to the project root.
  archive_path: "data/urv_teaching_guides.zip"

  # If TRUE, always re-download the archive even if the local file exists.
  force_download: false

  # If TRUE, the zip is unzipped into `root`. The pipeline assumes
  # the archive creates a folder called `dir` under `root`.
  zip: true

  # Optional format identifier for the scraping layout.
  # format: "web_scraper_v1"

# -------------------------------------------------------------------
# translate section
# -------------------------------------------------------------------
translate:
  enabled: true
  mode: "auto"
  service: "libretranslate"
  source_lang: "auto"
  target_lang: "en"
  max_cores: 4
  batch_size: 200
  output_dir: "sandbox/translations"
  columns:
    - description
    - contents
    - competences_learning_results
    - references
  check_service: true
  libretranslate_base_url: "http://libretranslate:5000"
  apertium_base_url: "http://apertium:2737"
  healthcheck_path: "/health"
  healthcheck_timeout_sec: 60
  healthcheck_poll_interval_sec: 2

# -------------------------------------------------------------------
# sdg_detection section
# -------------------------------------------------------------------
sdg_detection:
  enabled: true
  translation_dir: "sandbox/translations"
  method: "systems"
  systems:
    - "Aurora"
    - "Elsevier"
    - "Auckland"
    - "SIRIS"
    - "SDGO"
    - "SDSN"
  sdgs: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17]
  verbose: false
  combine_groups:
    - id: "course_info"
      prefix: "Course information: "
      columns:
        - description_en
        - contents_en
    - id: "competences"
      prefix: "Competences and learning outcomes: "
      columns:
        - competences_learning_results_en
    - id: "references"
      prefix: "References: "
      columns:
        - references_en
  aggregate:
    mode: "counts"
    min_hits: 1
